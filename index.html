@dp.message(lambda message: message.web_app_data is not None)
async def handle_webapp(message: types.Message):
    """Обработка данных из WebApp"""
    try:
        await log_action(
            "WebApp interaction",
            message.from_user,
            "Data received from WebApp",
            {
                "url": message.web_app_data.url,
                "data": message.web_app_data.data
            }
        )
        await message.answer(f"Received data: {message.web_app_data.data}")
    except Exception as e:
        await log_action("WebApp data handling failed", message.from_user, f"Error: {str(e)}")
        await message.answer("Failed to process WebApp data.")
